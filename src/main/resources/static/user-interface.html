<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>E-Commerce Admin & Seller Dashboard</title>
    <style>
        * { box-sizing: border-box; }

        body {
            margin: 0;
            font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
            background: #f5f7fb;
            color: #222;
        }

        header {
            background: #1f2933;
            color: #fff;
            padding: 16px 24px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        header h1 {
            margin: 0;
            font-size: 20px;
        }

        header span {
            font-size: 13px;
            opacity: 0.85;
        }

        nav {
            display: flex;
            gap: 8px;
            padding: 10px 16px;
            background: #eef1f7;
            border-bottom: 1px solid #d0d7e2;
            flex-wrap: wrap;
        }

        nav button {
            border: none;
            padding: 8px 14px;
            border-radius: 999px;
            background: #ffffff;
            cursor: pointer;
            font-size: 13px;
            border: 1px solid transparent;
            transition: all 0.15s ease;
        }

        nav button:hover { background: #e5edff; }

        nav button.active {
            background: #2563eb;
            color: #fff;
            border-color: #1d4ed8;
        }

        main {
            padding: 16px;
            max-width: 1100px;
            margin: 0 auto 32px auto;
        }

        .view {
            display: none;
            background: #fff;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 4px 10px rgba(15, 23, 42, 0.05);
            margin-top: 8px;
        }

        .view.active { display: block; }

        .section-title {
            font-size: 24px;
            margin-bottom: 4px;
        }

        .section-subtitle {
            font-size: 13px;
            color: #555;
            margin-bottom: 16px;
        }

        form {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 12px 18px;
            margin-bottom: 16px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        label {
            font-size: 13px;
            font-weight: 600;
        }

        input[type="text"],
        input[type="number"],
        input[type="email"],
        textarea {
            padding: 7px 9px;
            border-radius: 8px;
            border: 1px solid #cbd2e1;
            font-size: 13px;
            outline: none;
        }

        textarea {
            resize: vertical;
            min-height: 60px;
        }

        input:focus,
        textarea:focus {
            border-color: #2563eb;
            box-shadow: 0 0 0 1px rgba(37, 99, 235, 0.25);
        }

        .checkbox-row {
            display: flex;
            align-items: center;
            gap: 6px;
            margin-top: 4px;
        }

        .actions { margin-top: 4px; }

        .btn-primary {
            border: none;
            padding: 8px 16px;
            border-radius: 999px;
            background: #2563eb;
            color: #fff;
            font-size: 13px;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: 6px;
        }

        .btn-primary:hover { background: #1d4ed8; }

        .btn-secondary {
            border: 1px solid #cbd2e1;
            padding: 7px 14px;
            border-radius: 999px;
            background: #fff;
            font-size: 13px;
            cursor: pointer;
            margin-left: 8px;
        }

        .status-text {
            font-size: 13px;
            margin-top: 8px;
            min-height: 18px;
        }

        .status-text.success { color: #15803d; }
        .status-text.error   { color: #b91c1c; }
        .status-text.info    { color: #1d4ed8; }

        .response-box {
            margin-top: 8px;
            border-radius: 8px;
            background: #0f172a;
            color: #e5e7eb;
            padding: 10px;
            font-size: 12px;
            max-height: 280px;
            overflow: auto;
            white-space: pre-wrap;
        }

        .cards-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
            gap: 16px;
            margin-top: 16px;
        }

        /* PRODUCT CARD STYLE */
        .product-card {
            border-radius: 12px;
            border: 1px solid #e0e0e0;
            padding: 16px;
            background: #fff;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            max-width: 360px;
            font-size: 14px;
        }

        .product-card img {
            width: 100%;
            max-height: 260px;
            object-fit: contain;
            border-radius: 8px;
            display: block;
            margin-bottom: 12px;
            background: #fafafa;
        }

        .product-name {
            font-weight: 700;
            margin-bottom: 4px;
        }

        .product-price {
            color: #008000;
            font-weight: 700;
            margin-bottom: 6px;
        }

        .product-desc {
            color: #555;
            font-size: 13px;
            margin-bottom: 4px;
        }

        .product-meta {
            color: #555;
            font-size: 13px;
        }

        .home-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 14px;
            margin-top: 12px;
        }

        .home-card {
            border-radius: 12px;
            padding: 14px;
            background: #ffffff;
            border: 1px solid #d0d7e2;
        }

        .home-card h3 {
            margin: 0 0 6px 0;
            font-size: 15px;
        }

        .home-card p {
            margin: 0;
            font-size: 13px;
            color: #555;
        }

        .order-items {
            margin-top: 10px;
            font-size: 13px;
        }

        .order-items table {
            width: 100%;
            border-collapse: collapse;
        }

        .order-items th,
        .order-items td {
            border: 1px solid #d0d7e2;
            padding: 4px 6px;
            text-align: left;
            font-size: 13px;
        }

        .order-total {
            margin-top: 6px;
            font-weight: 700;
        }

        @media (max-width: 640px) {
            header {
                flex-direction: column;
                align-items: flex-start;
                gap: 4px;
            }
        }
    </style>
</head>
<body>
<header>
    <div>
        <h1>E-Commerce Admin & Seller Dashboard</h1>
        <span>Manage companies, sellers, products, and orders via your APIs</span>
    </div>
</header>

<nav>
    <button class="active" data-view="home">Home</button>
    <button data-view="company">Register Company</button>
    <button data-view="create-seller">Create Seller</button>
    <button data-view="delete-seller">Delete Seller</button>
    <button data-view="add-product">Add Product</button>
    <button data-view="update-product">Update Product</button>
    <button data-view="delete-product">Delete Product</button>
    <button data-view="list-products">View All Products</button>
    <button data-view="search-products">Product Search</button>
    <button data-view="upload-image">Upload Image</button>
    <button data-view="bulk-upload">Bulk Product Upload (CSV)</button>
    <button data-view="preview-image">Preview Image by URL</button>
    <button data-view="add-to-cart">Add to Cart</button>
    <button data-view="submit-order">Submit Order</button>
</nav>

<main>
    <!-- HOME -->
    <section id="view-home" class="view active">
        <div class="section-title">Welcome ðŸ‘‹</div>
        <div class="section-subtitle">
            Use the navigation above to call different backend APIs running on <code>localhost:8080</code>.
        </div>

        <div class="home-grid">
            <div class="home-card">
                <h3>Company Management</h3>
                <p>Register new companies with <code>/api/admin/company</code>.</p>
            </div>
            <div class="home-card">
                <h3>Seller Management</h3>
                <p>Create and delete sellers using <code>/api/admin/seller</code>.</p>
            </div>
            <div class="home-card">
                <h3>Product Management</h3>
                <p>Add, update, delete, and search products via seller & customer APIs.</p>
            </div>
            <div class="home-card">
                <h3>Orders</h3>
                <p>Add items to cart and submit orders using customer order APIs.</p>
            </div>
        </div>
    </section>

    <!-- REGISTER COMPANY -->
    <section id="view-company" class="view">
        <div class="section-title">Register Company</div>
        <div class="section-subtitle">
            POST <code>http://localhost:8080/api/admin/company</code><br>
            Body: <code>{"name": "MNO Industries"}</code>
        </div>

        <form id="companyForm">
            <div class="form-group">
                <label for="companyName">Company Name</label>
                <input type="text" id="companyName" placeholder="MNO Industries" required>
            </div>
        </form>

        <div class="actions">
            <button class="btn-primary" id="companySubmitBtn">Register Company</button>
        </div>

        <div id="companyStatus" class="status-text"></div>
        <pre id="companyResponse" class="response-box"></pre>
    </section>

    <!-- CREATE SELLER -->
    <section id="view-create-seller" class="view">
        <div class="section-title">Create Seller</div>
        <div class="section-subtitle">
            POST <code>http://localhost:8080/api/admin/seller</code><br>
            Body: <code>{"name":"Ravi","email":"ravi@mail.com","companyId":2}</code>
        </div>

        <form id="sellerForm">
            <div class="form-group">
                <label for="sellerName">Seller Name</label>
                <input type="text" id="sellerName" placeholder="Ravi" required>
            </div>
            <div class="form-group">
                <label for="sellerEmail">Email</label>
                <input type="email" id="sellerEmail" placeholder="ravi@mail.com" required>
            </div>
            <div class="form-group">
                <label for="sellerCompanyId">Company ID</label>
                <input type="number" id="sellerCompanyId" placeholder="2" required>
            </div>
        </form>

        <div class="actions">
            <button class="btn-primary" id="sellerSubmitBtn">Create Seller</button>
        </div>

        <div id="sellerStatus" class="status-text"></div>
        <pre id="sellerResponse" class="response-box"></pre>
    </section>

    <!-- DELETE SELLER -->
    <section id="view-delete-seller" class="view">
        <div class="section-title">Delete Seller</div>
        <div class="section-subtitle">
            DELETE <code>http://localhost:8080/api/admin/seller/{id}</code><br>
            Example: <code>http://localhost:8080/api/admin/seller/90</code>
        </div>

        <form id="deleteSellerForm">
            <div class="form-group">
                <label for="deleteSellerId">Seller ID</label>
                <input type="number" id="deleteSellerId" placeholder="90" required>
            </div>
        </form>

        <div class="actions">
            <button class="btn-primary" id="deleteSellerBtn">Delete Seller</button>
        </div>

        <div id="deleteSellerStatus" class="status-text"></div>
        <pre id="deleteSellerResponse" class="response-box"></pre>
    </section>

    <!-- ADD PRODUCT -->
    <section id="view-add-product" class="view">
        <div class="section-title">Add Product</div>
        <div class="section-subtitle">
            POST <code>http://localhost:8080/api/seller/addProduct</code>
        </div>

        <form id="productForm">
            <div class="form-group">
                <label for="productName">Name</label>
                <input type="text" id="productName" placeholder="Samsung S24" required>
            </div>
            <div class="form-group">
                <label for="productDescription">Description</label>
                <textarea id="productDescription" placeholder="Samsung S24 Phone" required></textarea>
            </div>
            <div class="form-group">
                <label for="productPrice">Price</label>
                <input type="number" step="0.01" id="productPrice" placeholder="94999.0" required>
            </div>
            <div class="form-group">
                <label for="productStock">Stock</label>
                <input type="number" id="productStock" placeholder="45" required>
            </div>
            <div class="form-group">
                <label>Active</label>
                <div class="checkbox-row">
                    <input type="checkbox" id="productActive" checked>
                    <span>Is Active</span>
                </div>
            </div>
            <div class="form-group">
                <label for="productImageUrl">Image URL</label>
                <input type="text" id="productImageUrl"
                       placeholder="http://localhost:8080/content/..." required>
            </div>
            <div class="form-group">
                <label for="productCompanyId">Company ID</label>
                <input type="number" id="productCompanyId" placeholder="2" required>
            </div>
            <div class="form-group">
                <label for="productCategoryId">Category ID</label>
                <input type="number" id="productCategoryId" placeholder="1" required>
            </div>
        </form>

        <div class="actions">
            <button class="btn-primary" id="productSubmitBtn">Add Product</button>
        </div>

        <div id="productStatus" class="status-text"></div>
        <pre id="productResponse" class="response-box"></pre>
    </section>

    <!-- UPDATE PRODUCT -->
    <section id="view-update-product" class="view">
        <div class="section-title">Update Product</div>
        <div class="section-subtitle">
            PUT <code>http://localhost:8080/api/seller/product/{id}</code><br>
            Example body for ID 4 as in your docs.
        </div>

        <form id="updateProductForm">
            <div class="form-group">
                <label for="updateProductId">Product ID (path param)</label>
                <input type="number" id="updateProductId" placeholder="4" required>
            </div>
            <div class="form-group">
                <label for="updateProductName">Name</label>
                <input type="text" id="updateProductName" placeholder="Macbook M2 Laptop" required>
            </div>
            <div class="form-group">
                <label for="updateProductDescription">Description</label>
                <textarea id="updateProductDescription" placeholder="Apple Macbook Air M2" required></textarea>
            </div>
            <div class="form-group">
                <label for="updateProductPrice">Price</label>
                <input type="number" step="0.01" id="updateProductPrice" placeholder="72999.0" required>
            </div>
            <div class="form-group">
                <label for="updateProductStock">Stock</label>
                <input type="number" id="updateProductStock" placeholder="48" required>
            </div>
            <div class="form-group">
                <label>Active</label>
                <div class="checkbox-row">
                    <input type="checkbox" id="updateProductActive" checked>
                    <span>Is Active</span>
                </div>
            </div>
            <div class="form-group">
                <label for="updateProductImageUrl">Image URL</label>
                <input type="text" id="updateProductImageUrl"
                       placeholder="http://localhost:8080/content/..." required>
            </div>
            <div class="form-group">
                <label for="updateProductCompanyId">Company ID</label>
                <input type="number" id="updateProductCompanyId" placeholder="2" required>
            </div>
            <div class="form-group">
                <label for="updateProductCategoryId">Category ID</label>
                <input type="number" id="updateProductCategoryId" placeholder="1" required>
            </div>
        </form>

        <div class="actions">
            <button class="btn-primary" id="updateProductBtn">Update Product</button>
        </div>

        <div id="updateProductStatus" class="status-text"></div>
        <pre id="updateProductResponse" class="response-box"></pre>
    </section>

    <!-- DELETE PRODUCT -->
    <section id="view-delete-product" class="view">
        <div class="section-title">Delete Product</div>
        <div class="section-subtitle">
            DELETE <code>http://localhost:8080/api/seller/product/{id}</code><br>
            Example: <code>http://localhost:8080/api/seller/product/3</code>
        </div>

        <form id="deleteProductForm">
            <div class="form-group">
                <label for="deleteProductId">Product ID</label>
                <input type="number" id="deleteProductId" placeholder="3" required>
            </div>
        </form>

        <div class="actions">
            <button class="btn-primary" id="deleteProductBtn">Delete Product</button>
        </div>

        <div id="deleteProductStatus" class="status-text"></div>
        <pre id="deleteProductResponse" class="response-box"></pre>
    </section>

    <!-- ALL PRODUCTS -->
    <section id="view-list-products" class="view">
        <div class="section-title">All Products</div>
        <div class="section-subtitle">
            GET <code>http://localhost:8080/api/seller/product</code>
        </div>

        <div class="actions">
            <button class="btn-primary" id="fetchProductsBtn">Fetch Products</button>
            <button class="btn-secondary" id="clearProductsBtn">Clear</button>
        </div>

        <div id="productsStatus" class="status-text"></div>
        <div id="productsContainer" class="cards-grid"></div>
        <pre id="productsRawResponse" class="response-box"></pre>
    </section>

    <!-- PRODUCT SEARCH -->
    <section id="view-search-products" class="view">
        <div class="section-title">Product Search</div>
        <div class="section-subtitle">
            GET <code>http://localhost:8080/api/customer/products?keyword=...&pageSize=3&pageNo=0</code>
        </div>

        <form id="searchForm">
            <div class="form-group">
                <label for="searchKeyword">Keyword</label>
                <input type="text" id="searchKeyword" placeholder="Motorola, S24, Macbook..." required>
            </div>
        </form>

        <div class="actions">
            <button class="btn-primary" id="searchBtn">Search</button>
        </div>

        <div id="searchStatus" class="status-text"></div>
        <div id="searchResults" class="cards-grid"></div>
        <pre id="searchRawResponse" class="response-box"></pre>
    </section>

    <!-- IMAGE UPLOAD -->
    <section id="view-upload-image" class="view">
        <div class="section-title">Upload Product Image</div>
        <div class="section-subtitle">
            POST <code>http://localhost:8080/api/seller/product/image</code><br>
            Returns a URL like <code>http://localhost:8080/content/...</code>
        </div>

        <form id="uploadImageForm">
            <div class="form-group">
                <label for="imageFile">Select Image</label>
                <input type="file" id="imageFile" accept="image/*">
            </div>
        </form>

        <div class="actions">
            <button class="btn-primary" id="uploadImageBtn">Upload Image</button>
        </div>

        <div id="uploadImageStatus" class="status-text"></div>
        <pre id="uploadImageResponse" class="response-box"></pre>

        <div id="uploadImagePreviewContainer" class="cards-grid"></div>
    </section>

    <!-- BULK PRODUCT UPLOAD CSV -->
    <section id="view-bulk-upload" class="view">
        <div class="section-title">Bulk Product Upload (CSV)</div>
        <div class="section-subtitle">
            POST <code>http://localhost:8080/api/seller/product/bulk</code><br>
            Response: array with <code>id</code>, <code>errorCode</code>, <code>message</code>.
        </div>

        <form id="bulkUploadForm">
            <div class="form-group">
                <label for="bulkFile">Select CSV File</label>
                <input type="file" id="bulkFile" accept=".csv">
            </div>
        </form>

        <div class="actions">
            <button class="btn-primary" id="bulkUploadBtn">Upload CSV</button>
        </div>

        <div id="bulkStatus" class="status-text"></div>
        <pre id="bulkResponse" class="response-box"></pre>
    </section>

    <!-- PREVIEW IMAGE BY URL -->
    <section id="view-preview-image" class="view">
        <div class="section-title">Preview Image by URL</div>
        <div class="section-subtitle">
            GET <code>http://localhost:8080/content/&lt;id&gt;_furniture.webp</code>
        </div>

        <form id="previewImageForm">
            <div class="form-group">
                <label for="previewImageUrl">Image URL</label>
                <input type="text" id="previewImageUrl"
                       placeholder="http://localhost:8080/content/93f36792-be22-45e0-973c-f94bed52ee25_furniture.webp">
            </div>
        </form>

        <div class="actions">
            <button class="btn-primary" id="previewImageBtn">Show Image</button>
        </div>

        <div id="previewImageStatus" class="status-text"></div>
        <div id="previewImageContainer" class="cards-grid"></div>
    </section>

    <!-- ADD TO CART -->
    <section id="view-add-to-cart" class="view">
        <div class="section-title">Add to Cart</div>
        <div class="section-subtitle">
            POST <code>http://localhost:8080/api/customer/order-item</code><br>
            Request body depends on your backend (e.g. <code>{"productId": 5, "quantity": 1}</code>). Paste JSON below.
        </div>

        <form id="addToCartForm">
            <div class="form-group" style="grid-column: 1 / -1;">
                <label for="addToCartBody">Request JSON</label>
                <textarea id="addToCartBody" placeholder='{"productId": 5, "quantity": 1}'></textarea>
            </div>
        </form>

        <div class="actions">
            <button class="btn-primary" id="addToCartBtn">Add to Cart</button>
        </div>

        <div id="addToCartStatus" class="status-text"></div>
        <div id="addToCartSummary" class="order-items"></div>
        <pre id="addToCartResponse" class="response-box"></pre>
    </section>

    <!-- SUBMIT ORDER -->
    <section id="view-submit-order" class="view">
        <div class="section-title">Submit Order</div>
        <div class="section-subtitle">
            PUT <code>http://localhost:8080/api/customer/orders/{orderId}/submit</code><br>
            Example: <code>http://localhost:8080/api/customer/orders/1/submit</code>
        </div>

        <form id="submitOrderForm">
            <div class="form-group">
                <label for="submitOrderId">Order ID</label>
                <input type="number" id="submitOrderId" placeholder="1" required>
            </div>
        </form>

        <div class="actions">
            <button class="btn-primary" id="submitOrderBtn">Submit Order</button>
        </div>

        <div id="submitOrderStatus" class="status-text"></div>
        <pre id="submitOrderResponse" class="response-box"></pre>
    </section>
</main>

<script>
    document.addEventListener("DOMContentLoaded", () => {
        const navButtons = document.querySelectorAll("nav button[data-view]");
        const views = document.querySelectorAll(".view");

        navButtons.forEach(btn => {
            btn.addEventListener("click", () => {
                const target = btn.getAttribute("data-view");
                navButtons.forEach(b => b.classList.remove("active"));
                btn.classList.add("active");

                views.forEach(v => {
                    if (v.id === "view-" + target) v.classList.add("active");
                    else v.classList.remove("active");
                });
            });
        });

        setupCompanyForm();
        setupSellerForm();
        setupDeleteSellerForm();
        setupProductForm();
        setupUpdateProductForm();
        setupDeleteProductForm();
        setupProductsList();
        setupSearchProducts();
        setupImageUpload();
        setupBulkUpload();
        setupPreviewImage();
        setupAddToCart();
        setupSubmitOrder();
    });

    function setStatus(el, text, type) {
        el.textContent = text || "";
        el.classList.remove("success", "error", "info");
        if (type) el.classList.add(type);
    }

    function formatJson(obj) {
        if (obj === null || obj === undefined || obj === "") return "";
        try { return JSON.stringify(obj, null, 2); }
        catch { return String(obj); }
    }

    // REGISTER COMPANY
    function setupCompanyForm() {
        const nameInput = document.getElementById("companyName");
        const submitBtn = document.getElementById("companySubmitBtn");
        const statusEl = document.getElementById("companyStatus");
        const responseEl = document.getElementById("companyResponse");

        submitBtn.addEventListener("click", async () => {
            const name = nameInput.value.trim();
            responseEl.textContent = "";
            if (!name) {
                setStatus(statusEl, "Company name is required.", "error");
                return;
            }

            setStatus(statusEl, "Sending request...", "info");
            try {
                const res = await fetch("http://localhost:8080/api/admin/company", {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json",
                        "Accept": "application/json"
                    },
                    body: JSON.stringify({ name })
                });

                let body = null;
                try { body = await res.json(); } catch (_) { body = null; }

                if (!res.ok) {
                    setStatus(statusEl, `Error: ${res.status} ${res.statusText}`, "error");
                } else {
                    setStatus(statusEl, "Company registered successfully.", "success");
                }
                responseEl.textContent = formatJson(body);
            } catch (e) {
                console.error(e);
                setStatus(statusEl, "Network error while calling API.", "error");
            }
        });
    }

    // CREATE SELLER
    function setupSellerForm() {
        const nameInput = document.getElementById("sellerName");
        const emailInput = document.getElementById("sellerEmail");
        const companyIdInput = document.getElementById("sellerCompanyId");
        const submitBtn = document.getElementById("sellerSubmitBtn");
        const statusEl = document.getElementById("sellerStatus");
        const responseEl = document.getElementById("sellerResponse");

        submitBtn.addEventListener("click", async () => {
            const name = nameInput.value.trim();
            const email = emailInput.value.trim();
            const companyId = parseInt(companyIdInput.value, 10);

            responseEl.textContent = "";
            if (!name || !email || isNaN(companyId)) {
                setStatus(statusEl, "Name, email, and company ID are required.", "error");
                return;
            }

            setStatus(statusEl, "Sending request...", "info");
            try {
                const res = await fetch("http://localhost:8080/api/admin/seller", {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json",
                        "Accept": "application/json"
                    },
                    body: JSON.stringify({ name, email, companyId })
                });

                let body = null;
                try { body = await res.json(); } catch (_) { body = null; }

                if (!res.ok) {
                    setStatus(statusEl, `Error: ${res.status} ${res.statusText}`, "error");
                } else {
                    setStatus(statusEl, "Seller created successfully.", "success");
                }
                responseEl.textContent = formatJson(body);
            } catch (e) {
                console.error(e);
                setStatus(statusEl, "Network error while calling API.", "error");
            }
        });
    }

    // DELETE SELLER
    function setupDeleteSellerForm() {
        const idInput = document.getElementById("deleteSellerId");
        const deleteBtn = document.getElementById("deleteSellerBtn");
        const statusEl = document.getElementById("deleteSellerStatus");
        const responseEl = document.getElementById("deleteSellerResponse");

        deleteBtn.addEventListener("click", async () => {
            const id = parseInt(idInput.value, 10);
            responseEl.textContent = "";
            if (isNaN(id)) {
                setStatus(statusEl, "Valid seller ID is required.", "error");
                return;
            }

            setStatus(statusEl, "Sending delete request...", "info");
            try {
                const res = await fetch(`http://localhost:8080/api/admin/seller/${id}`, {
                    method: "DELETE",
                    headers: { "Accept": "application/json" }
                });

                let body = null;
                try { body = await res.json(); } catch (_) { body = null; }

                if (!res.ok) {
                    setStatus(statusEl, `Error: ${res.status} ${res.statusText}`, "error");
                } else {
                    setStatus(statusEl, `Seller with ID ${id} deleted (if existed).`, "success");
                }
                responseEl.textContent = formatJson(body);
            } catch (e) {
                console.error(e);
                setStatus(statusEl, "Network error while calling API.", "error");
            }
        });
    }

    // ADD PRODUCT
    function setupProductForm() {
        const nameInput = document.getElementById("productName");
        const descInput = document.getElementById("productDescription");
        const priceInput = document.getElementById("productPrice");
        const stockInput = document.getElementById("productStock");
        const activeInput = document.getElementById("productActive");
        const imageUrlInput = document.getElementById("productImageUrl");
        const companyIdInput = document.getElementById("productCompanyId");
        const categoryIdInput = document.getElementById("productCategoryId");
        const submitBtn = document.getElementById("productSubmitBtn");
        const statusEl = document.getElementById("productStatus");
        const responseEl = document.getElementById("productResponse");

        submitBtn.addEventListener("click", async () => {
            const name = nameInput.value.trim();
            const description = descInput.value.trim();
            const price = parseFloat(priceInput.value);
            const stock = parseInt(stockInput.value, 10);
            const active = activeInput.checked;
            const imageUrl = imageUrlInput.value.trim();
            const companyId = parseInt(companyIdInput.value, 10);
            const categoryId = parseInt(categoryIdInput.value, 10);

            responseEl.textContent = "";
            if (!name || !description || isNaN(price) || isNaN(stock) ||
                !imageUrl || isNaN(companyId) || isNaN(categoryId)) {
                setStatus(statusEl, "All fields are required and must be valid.", "error");
                return;
            }

            setStatus(statusEl, "Sending request...", "info");

            const bodyObj = {
                name,
                description,
                price,
                stock,
                active,
                imageUrl,
                companyId,
                categoryId
            };

            try {
                const res = await fetch("http://localhost:8080/api/seller/addProduct", {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json",
                        "Accept": "application/json"
                    },
                    body: JSON.stringify(bodyObj)
                });

                let body = null;
                try { body = await res.json(); } catch (_) { body = null; }

                if (!res.ok) {
                    setStatus(statusEl, `Error: ${res.status} ${res.statusText}`, "error");
                } else {
                    setStatus(statusEl, "Product added successfully.", "success");
                }
                responseEl.textContent = formatJson(body);
            } catch (e) {
                console.error(e);
                setStatus(statusEl, "Network error while calling API.", "error");
            }
        });
    }

    // UPDATE PRODUCT
    function setupUpdateProductForm() {
        const idInput = document.getElementById("updateProductId");
        const nameInput = document.getElementById("updateProductName");
        const descInput = document.getElementById("updateProductDescription");
        const priceInput = document.getElementById("updateProductPrice");
        const stockInput = document.getElementById("updateProductStock");
        const activeInput = document.getElementById("updateProductActive");
        const imageUrlInput = document.getElementById("updateProductImageUrl");
        const companyIdInput = document.getElementById("updateProductCompanyId");
        const categoryIdInput = document.getElementById("updateProductCategoryId");
        const submitBtn = document.getElementById("updateProductBtn");
        const statusEl = document.getElementById("updateProductStatus");
        const responseEl = document.getElementById("updateProductResponse");

        submitBtn.addEventListener("click", async () => {
            const id = parseInt(idInput.value, 10);
            const name = nameInput.value.trim();
            const description = descInput.value.trim();
            const price = parseFloat(priceInput.value);
            const stock = parseInt(stockInput.value, 10);
            const active = activeInput.checked;
            const imageUrl = imageUrlInput.value.trim();
            const companyId = parseInt(companyIdInput.value, 10);
            const categoryId = parseInt(categoryIdInput.value, 10);

            responseEl.textContent = "";
            if (isNaN(id) || !name || !description || isNaN(price) || isNaN(stock) ||
                !imageUrl || isNaN(companyId) || isNaN(categoryId)) {
                setStatus(statusEl, "All fields (including ID) are required and must be valid.", "error");
                return;
            }

            setStatus(statusEl, "Sending request...", "info");

            const bodyObj = {
                id,
                name,
                description,
                price,
                stock,
                active,
                imageUrl,
                companyId,
                categoryId
            };

            try {
                const res = await fetch(`http://localhost:8080/api/seller/product/${id}`, {
                    method: "PUT",
                    headers: {
                        "Content-Type": "application/json",
                        "Accept": "application/json"
                    },
                    body: JSON.stringify(bodyObj)
                });

                let body = null;
                try { body = await res.json(); } catch (_) { body = null; }

                if (!res.ok) {
                    setStatus(statusEl, `Error: ${res.status} ${res.statusText}`, "error");
                } else {
                    setStatus(statusEl, "Product updated successfully.", "success");
                }
                responseEl.textContent = formatJson(body);
            } catch (e) {
                console.error(e);
                setStatus(statusEl, "Network error while calling API.", "error");
            }
        });
    }

    // DELETE PRODUCT
    function setupDeleteProductForm() {
        const idInput = document.getElementById("deleteProductId");
        const deleteBtn = document.getElementById("deleteProductBtn");
        const statusEl = document.getElementById("deleteProductStatus");
        const responseEl = document.getElementById("deleteProductResponse");

        deleteBtn.addEventListener("click", async () => {
            const id = parseInt(idInput.value, 10);
            responseEl.textContent = "";
            if (isNaN(id)) {
                setStatus(statusEl, "Valid product ID is required.", "error");
                return;
            }

            setStatus(statusEl, "Sending delete request...", "info");
            try {
                const res = await fetch(`http://localhost:8080/api/seller/product/${id}`, {
                    method: "DELETE",
                    headers: { "Accept": "application/json" }
                });

                let body = null;
                try { body = await res.json(); } catch (_) { body = null; }

                if (!res.ok) {
                    setStatus(statusEl, `Error: ${res.status} ${res.statusText}`, "error");
                } else {
                    setStatus(statusEl, `Product with ID ${id} deleted (if existed).`, "success");
                }
                responseEl.textContent = formatJson(body);
            } catch (e) {
                console.error(e);
                setStatus(statusEl, "Network error while calling API.", "error");
            }
        });
    }

    // ALL PRODUCTS
    function setupProductsList() {
        const fetchBtn = document.getElementById("fetchProductsBtn");
        const clearBtn = document.getElementById("clearProductsBtn");
        const statusEl = document.getElementById("productsStatus");
        const containerEl = document.getElementById("productsContainer");
        const rawResponseEl = document.getElementById("productsRawResponse");

        fetchBtn.addEventListener("click", async () => {
            containerEl.innerHTML = "";
            rawResponseEl.textContent = "";
            setStatus(statusEl, "Fetching products...", "info");

            try {
                const res = await fetch("http://localhost:8080/api/seller/product", {
                    method: "GET",
                    headers: { "Accept": "application/json" }
                });

                const data = await res.json();

                if (!res.ok) {
                    setStatus(statusEl, `Error: ${res.status} ${res.statusText}`, "error");
                    rawResponseEl.textContent = formatJson(data);
                    return;
                }

                if (!Array.isArray(data) || data.length === 0) {
                    setStatus(statusEl, "No products found.", "info");
                    rawResponseEl.textContent = formatJson(data);
                    return;
                }

                setStatus(statusEl, `Loaded ${data.length} product(s).`, "success");
                rawResponseEl.textContent = formatJson(data);

                data.forEach(p => {
                    const card = document.createElement("div");
                    card.className = "product-card";

                    if (p.imageUrl && p.imageUrl.trim() !== "") {
                        const img = document.createElement("img");
                        img.src = p.imageUrl;
                        img.alt = p.name || "Product image";
                        card.appendChild(img);
                    }

                    const nameEl = document.createElement("div");
                    nameEl.className = "product-name";
                    nameEl.textContent = p.name || "";
                    card.appendChild(nameEl);

                    const priceEl = document.createElement("div");
                    priceEl.className = "product-price";
                    priceEl.textContent = p.price != null ? `â‚¹${p.price}` : "";
                    card.appendChild(priceEl);

                    const descEl = document.createElement("div");
                    descEl.className = "product-desc";
                    descEl.textContent = p.description || "";
                    card.appendChild(descEl);

                    const metaEl = document.createElement("div");
                    metaEl.className = "product-meta";
                    const activeText = p.active ? "Yes" : "No";
                    metaEl.textContent = `Stock: ${p.stock} | Active: ${activeText}`;
                    card.appendChild(metaEl);

                    containerEl.appendChild(card);
                });
            } catch (e) {
                console.error(e);
                setStatus(statusEl, "Network error while calling API.", "error");
            }
        });

        clearBtn.addEventListener("click", () => {
            containerEl.innerHTML = "";
            rawResponseEl.textContent = "";
            setStatus(statusEl, "", null);
        });
    }

    // PRODUCT SEARCH (customer)
    function setupSearchProducts() {
        const keywordInput = document.getElementById("searchKeyword");
        const searchBtn = document.getElementById("searchBtn");
        const statusEl = document.getElementById("searchStatus");
        const resultsEl = document.getElementById("searchResults");
        const rawEl = document.getElementById("searchRawResponse");

        searchBtn.addEventListener("click", async () => {
            const keyword = keywordInput.value.trim();
            resultsEl.innerHTML = "";
            rawEl.textContent = "";

            if (!keyword) {
                setStatus(statusEl, "Please enter a keyword.", "error");
                return;
            }

            setStatus(statusEl, "Searching...", "info");

            const pageSize = 3;
            const pageNo = 0;
            const url = `http://localhost:8080/api/customer/products?keyword=${encodeURIComponent(keyword)}&pageSize=${pageSize}&pageNo=${pageNo}`;

            try {
                const res = await fetch(url, {
                    method: "GET",
                    headers: { "Accept": "application/json" }
                });

                const data = await res.json();

                if (!res.ok) {
                    setStatus(statusEl, `Error: ${res.status} ${res.statusText}`, "error");
                    rawEl.textContent = formatJson(data);
                    return;
                }

                if (!Array.isArray(data) || data.length === 0) {
                    setStatus(statusEl, "No products found for this keyword.", "info");
                    rawEl.textContent = formatJson(data);
                    return;
                }

                setStatus(statusEl, `Found ${data.length} product(s).`, "success");
                rawEl.textContent = formatJson(data);

                data.forEach(p => {
                    const card = document.createElement("div");
                    card.className = "product-card";

                    if (p.imageUrl && p.imageUrl.trim() !== "") {
                        const img = document.createElement("img");
                        img.src = p.imageUrl;
                        img.alt = p.name || "Product image";
                        card.appendChild(img);
                    }

                    const nameEl = document.createElement("div");
                    nameEl.className = "product-name";
                    nameEl.textContent = p.name || "";
                    card.appendChild(nameEl);

                    const priceEl = document.createElement("div");
                    priceEl.className = "product-price";
                    priceEl.textContent = p.price != null ? `â‚¹${p.price}` : "";
                    card.appendChild(priceEl);

                    const descEl = document.createElement("div");
                    descEl.className = "product-desc";
                    descEl.textContent = p.description || "";
                    card.appendChild(descEl);

                    const metaEl = document.createElement("div");
                    metaEl.className = "product-meta";
                    const activeText = p.active ? "Yes" : "No";
                    metaEl.textContent = `Stock: ${p.stock} | Active: ${activeText}`;
                    card.appendChild(metaEl);

                    resultsEl.appendChild(card);
                });
            } catch (e) {
                console.error(e);
                setStatus(statusEl, "Network error while calling API.", "error");
            }
        });
    }

    // IMAGE UPLOAD
    function setupImageUpload() {
        const fileInput = document.getElementById("imageFile");
        const uploadBtn = document.getElementById("uploadImageBtn");
        const statusEl = document.getElementById("uploadImageStatus");
        const responseEl = document.getElementById("uploadImageResponse");
        const previewContainer = document.getElementById("uploadImagePreviewContainer");

        uploadBtn.addEventListener("click", async () => {
            const file = fileInput.files[0];
            responseEl.textContent = "";
            previewContainer.innerHTML = "";

            if (!file) {
                setStatus(statusEl, "Please select an image file.", "error");
                return;
            }

            const formData = new FormData();
            // assuming backend param name is "file"
            formData.append("file", file);

            setStatus(statusEl, "Uploading image...", "info");
            try {
                const res = await fetch("http://localhost:8080/api/seller/product/image", {
                    method: "POST",
                    body: formData
                });

                let text = await res.text();
                let body = text;
                try {
                    body = JSON.parse(text);
                } catch (_) {}

                if (!res.ok) {
                    setStatus(statusEl, `Error: ${res.status} ${res.statusText}`, "error");
                } else {
                    setStatus(statusEl, "Image uploaded successfully.", "success");
                }
                responseEl.textContent = formatJson(body);

                let url = null;
                if (typeof body === "string") {
                    url = body;
                } else if (body && typeof body === "object") {
                    if (body.imageUrl) url = body.imageUrl;
                    else if (body.url) url = body.url;
                }

                if (url) {
                    const card = document.createElement("div");
                    card.className = "product-card";
                    const img = document.createElement("img");
                    img.src = url;
                    img.alt = "Uploaded image";
                    card.appendChild(img);

                    const meta = document.createElement("div");
                    meta.className = "product-desc";
                    meta.textContent = url;
                    card.appendChild(meta);

                    previewContainer.appendChild(card);
                }
            } catch (e) {
                console.error(e);
                setStatus(statusEl, "Network error while calling API.", "error");
            }
        });
    }

    // BULK UPLOAD CSV
    function setupBulkUpload() {
        const fileInput = document.getElementById("bulkFile");
        const uploadBtn = document.getElementById("bulkUploadBtn");
        const statusEl = document.getElementById("bulkStatus");
        const responseEl = document.getElementById("bulkResponse");

        uploadBtn.addEventListener("click", async () => {
            const file = fileInput.files[0];
            responseEl.textContent = "";

            if (!file) {
                setStatus(statusEl, "Please select a CSV file.", "error");
                return;
            }

            const formData = new FormData();
            formData.append("file", file);

            setStatus(statusEl, "Uploading CSV...", "info");
            try {
                const res = await fetch("http://localhost:8080/api/seller/product/bulk", {
                    method: "POST",
                    body: formData
                });

                const data = await res.json();

                if (!res.ok) {
                    setStatus(statusEl, `Error: ${res.status} ${res.statusText}`, "error");
                } else {
                    setStatus(statusEl, "Bulk upload completed.", "success");
                }
                responseEl.textContent = formatJson(data);
            } catch (e) {
                console.error(e);
                setStatus(statusEl, "Network error while calling API.", "error");
            }
        });
    }

    // PREVIEW IMAGE BY URL
    function setupPreviewImage() {
        const urlInput = document.getElementById("previewImageUrl");
        const btn = document.getElementById("previewImageBtn");
        const statusEl = document.getElementById("previewImageStatus");
        const container = document.getElementById("previewImageContainer");

        btn.addEventListener("click", () => {
            const url = urlInput.value.trim();
            container.innerHTML = "";

            if (!url) {
                setStatus(statusEl, "Please enter an image URL.", "error");
                return;
            }

            setStatus(statusEl, "Loading image...", "info");

            const card = document.createElement("div");
            card.className = "product-card";

            const img = document.createElement("img");
            img.src = url;
            img.alt = "Preview image";
            img.onload = () => setStatus(statusEl, "Image loaded.", "success");
            img.onerror = () => setStatus(statusEl, "Failed to load image.", "error");
            card.appendChild(img);

            const meta = document.createElement("div");
            meta.className = "product-desc";
            meta.textContent = url;
            card.appendChild(meta);

            container.appendChild(card);
        });
    }

    // ADD TO CART
    function setupAddToCart() {
        const bodyInput = document.getElementById("addToCartBody");
        const btn = document.getElementById("addToCartBtn");
        const statusEl = document.getElementById("addToCartStatus");
        const responseEl = document.getElementById("addToCartResponse");
        const summaryEl = document.getElementById("addToCartSummary");

        btn.addEventListener("click", async () => {
            const raw = bodyInput.value.trim();
            responseEl.textContent = "";
            summaryEl.innerHTML = "";

            if (!raw) {
                setStatus(statusEl, "Please enter request JSON.", "error");
                return;
            }

            let jsonBody;
            try {
                jsonBody = JSON.parse(raw);
            } catch (e) {
                setStatus(statusEl, "Invalid JSON format.", "error");
                return;
            }

            setStatus(statusEl, "Sending request...", "info");
            try {
                const res = await fetch("http://localhost:8080/api/customer/order-item", {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json",
                        "Accept": "application/json"
                    },
                    body: JSON.stringify(jsonBody)
                });

                const data = await res.json();

                if (!res.ok) {
                    setStatus(statusEl, `Error: ${res.status} ${res.statusText}`, "error");
                    responseEl.textContent = formatJson(data);
                    return;
                }

                setStatus(statusEl, "Item(s) added to cart.", "success");
                responseEl.textContent = formatJson(data);

                if (data && Array.isArray(data.orderItems)) {
                    let html = "<div>Order ID: " + data.orderId + "</div>";
                    html += "<div class='order-items'><table><thead><tr>" +
                        "<th>ID</th><th>Product</th><th>Qty</th><th>Price</th><th>Total</th>" +
                        "</tr></thead><tbody>";
                    data.orderItems.forEach(item => {
                        html += `<tr>
                            <td>${item.id}</td>
                            <td>${item.productName}</td>
                            <td>${item.quantity}</td>
                            <td>â‚¹${item.price}</td>
                            <td>â‚¹${item.totalPrice}</td>
                        </tr>`;
                    });
                    html += "</tbody></table></div>";
                    html += `<div class="order-total">Order Total: â‚¹${data.orderTotalPrice}</div>`;
                    summaryEl.innerHTML = html;
                }
            } catch (e) {
                console.error(e);
                setStatus(statusEl, "Network error while calling API.", "error");
            }
        });
    }

    // SUBMIT ORDER
    function setupSubmitOrder() {
        const idInput = document.getElementById("submitOrderId");
        const btn = document.getElementById("submitOrderBtn");
        const statusEl = document.getElementById("submitOrderStatus");
        const responseEl = document.getElementById("submitOrderResponse");

        btn.addEventListener("click", async () => {
            const id = parseInt(idInput.value, 10);
            responseEl.textContent = "";
            if (isNaN(id)) {
                setStatus(statusEl, "Valid order ID is required.", "error");
                return;
            }

            setStatus(statusEl, "Submitting order...", "info");
            try {
                const res = await fetch(`http://localhost:8080/api/customer/orders/${id}/submit`, {
                    method: "PUT",
                    headers: { "Accept": "application/json" }
                });

                let body = null;
                try { body = await res.json(); } catch (_) { body = null; }

                if (!res.ok) {
                    setStatus(statusEl, `Error: ${res.status} ${res.statusText}`, "error");
                } else {
                    setStatus(statusEl, "Order submitted successfully.", "success");
                }
                responseEl.textContent = formatJson(body);
            } catch (e) {
                console.error(e);
                setStatus(statusEl, "Network error while calling API.", "error");
            }
        });
    }
</script>
</body>
</html>
